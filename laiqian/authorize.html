<!doctype html>
<html lang="ch">
<head>
	<meta charset="UTF-8">
	<title>验证成功</title>
	<link rel="stylesheet" href="./css/reset.css?ver=version20141104">
	<link rel="stylesheet" href="./css/common.css?ver=version20141104">
	<link rel="stylesheet" href="./css/manage.css?ver=version20141104">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0">
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="format-detection" content="telephone=no"/>
	<meta http-equiv="pragma" content="no-cache">
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta http-equiv="pragma" content="no-cache">
	<meta http-equiv="cache-control" content="no-cache">
	<meta http-equiv="expires" content="0">
	<script type="text/javascript" src="./js/jquery.js?ver=version20141104"></script>
	<script type="text/javascript" src="./js/common.js?ver=version20141104"></script>
	<style>
	.info {
		text-align: center;
		font-size: 18px;
		padding-top: 20px;
	}
	</style>
	<script>
	$(function(){
		var custtype = 0;
		if(getLocal("custtype") == 1) {
			custtype = getLocal("custtype");
		}
		clearLocal("custtype");
		// 是否是真实账户注册跳转而来
		var openaccountcmd = "openaccount";
		if(getLocal("openaccountcmd") == "yxopenaccount") {
			openaccountcmd = getLocal("openaccountcmd");
		}
		clearLocal("openaccountcmd");
		
		clearLocal("errorUrl");
		$("#js_account_btn").on('click', function() {
			processing();
			var data={
				"cmd": openaccountcmd,
				"respcode": "0000",
				"custtype": 0
			};
			if(custtype == 1) {
				var data={
					"cmd": "addtradeacco",
					"respcode": "0000",
					"custtype": 1
				};
			}
			$.ajax({
				url: serverUrl,
				dataType: "json",
				data: $.extend(publicOpts, data),
				type: "POST",
				success: function(data) {
					processed();
					if(data.resCode == 1000){
						myAlert("恭喜您，成功开户！", function(){
							if(custtype == 0) {
								// 调用真实用户登录
								var idcard= getLocal("loginnumber");
								var password= getLocal("loginpwd");
								clearLocal("loginnumber");
								clearLocal("loginpwd");
								// 解除绑定
								$.ajax({
									url: serverUrl,
									dataType: "json",
									data: $.extend(publicOpts, {
										"cmd": "unbindinfo",
										"custtype": 1
									}),
									type: "POST",
									success: function(data) {
										// 调用真实用户登录
										$.ajax({
											url: serverUrl,
											dataType: "json",
											data: $.extend(publicOpts, {
												"cmd": "login", "loginnumber": idcard, "loginpwd": password, "logintype": "0", "custtype": 1
											}),
											type: "POST",
											success: function(data) {
												if(data.resCode == 1000) {
													setLocal("userSessionReality", JSON.stringify(data));
													setSession("traderBack", "false");
													document.location.href="./trader.html";
												}else {
													myAlert(data.errmsg, function(){
														if(data.errmsg.indexOf("绑定") > -1){
															document.location.href="manage.html";
															return;
														}
														document.location.href="login_reality.html";
													});
												}
											}
										});
									}
								});
							}else {
								document.location.href="./trader.html";
							}
						});
					}else {
						myAlert(data.errmsg, function(){
							if(data.errcode == "400000") {
								document.location.href="login_reality.html";
								// document.location.href="login_virtual.html";
							}else {
								document.location.href="v_trader.html";
							}
						});
					}
				}
			});
		});
	});
	</script>
</head>
<body class="manage">
	<header>
		<h1 class="title">验证成功</h1>
	</header>
	<section>
		<div class="info">尊敬的用户，您好！<br>您的银行卡已验证成功！</div>
		<div class="unbindinfo_btn" id="js_account_btn">立即开户</div>
	</section>
</body>
</html>